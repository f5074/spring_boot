<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tistory.f5074.spring_boot.mapper.EquipmentMapper">
	<select id="selectEqpMst" parameterType="hashmap" resultType="hashmap">
		/* selectEqpMst */
		SELECT EMST.PLANT_CODE AS SITE
			, EMST.EQP_ID
			, EMST.EQP_NO
			, EMST.EQP_TYPE
			, EMST.EQP_DESC AS EQP_DESC
		 FROM EQP_MST EMST
		WHERE EMST.PLANT_CODE = '1000'
		  AND EQP_TYPE = 'M'
	</select>
	<select id="selectEqpMaxLoad" parameterType="hashmap" resultType="hashmap">
		/* selectEqpMaxLoad */
		SELECT ELOAD.SITE
			, ELOAD.EQP_ID
			, ELOAD.EQP_NO
			, TO_CHAR(TO_TIMESTAMP(ELOAD.PER_MIN, 'YYYYMMDD HH24MISSFF3'),'YYYYMMDD HH24MI') AS PER_MIN
			, ELOAD.ITEM_SPEC
			, ELOAD.EQP_PART_NUMBER
			, ELOAD.ITEM_CD
			, ELOAD.ITEM_DESC
			, ELOAD.ITEM_VALUE
			, ELOAD.CREATE_TIME
			, ELOAD.ITEM_AVG
			, ELOAD.ITEM_RNG
			, EMST.EQP_DESC
		 FROM EQP_MAX_LOAD@CIMORA ELOAD
		INNER JOIN EQP_MST EMST ON EMST.EQP_ID = ELOAD.EQP_ID
		WHERE 1 = 1
			AND ELOAD.EQP_ID = #{EQP_ID}
		<if test="ITEM_CD != null and ITEM_CD != ''">
			AND ELOAD.ITEM_CD = #{ITEM_CD}
		</if>
			AND TO_CHAR(TO_TIMESTAMP(ELOAD.PER_MIN, 'YYYYMMDD HH24MISSFF3'),'YYYYMMDDHH24') > #{START_DT}
			AND TO_CHAR(TO_TIMESTAMP(ELOAD.PER_MIN, 'YYYYMMDD HH24MISSFF3'),'YYYYMMDDHH24') <![CDATA[<]]> #{END_DT}
		ORDER BY TO_CHAR(TO_TIMESTAMP(ELOAD.PER_MIN, 'YYYYMMDD HH24MISSFF3'),'HH24:MI') ASC
	</select>
	<select id="selectEqpCdSpec" parameterType="hashmap" resultType="hashmap">
		/* selectEqpCdSpec */
		SELECT ECD.ITEM_CD
			 , ECD.ITEM_DESC
		 FROM EQP_CD_SPEC@CIMORA ECD
		WHERE 1 = 1
		<if test="EQP_ID != null and EQP_ID != ''">
		  AND ECD.EQP_ID = #{EQP_ID}
		</if>
		GROUP BY ECD.ITEM_CD, ECD.ITEM_DESC
		ORDER BY ECD.ITEM_CD
	</select>
	<select id="selectEqpSrcData" parameterType="hashmap" resultType="hashmap">
		/* selectEqpSrcData */
		SELECT SRC.SITE
			, SRC.EQP_ID
			, SRC.EQP_NO
			, EMST.EQP_DESC
			, SRC.CUR_TIME
			, SRC.ITEM_SPEC
			, SRC.EQP_PART_NUMBER
			, SRC.ITEM_CD
			, SRC.ITEM_DESC
			, SRC.ITEM_VALUE
			, SRC.CREATE_TIME
		FROM EQP_SRC_DATA@CIMORA SRC
		INNER JOIN EQP_MST EMST ON EMST.EQP_ID = SRC.EQP_ID
		WHERE 1 = 1
		  AND SRC.SITE = #{SITE}
		  AND SRC.EQP_ID = #{EQP_ID}
		<if test="ITEM_CD != null and ITEM_CD.length != 0">
		  AND SRC.ITEM_CD IN <foreach collection="ITEM_CD" item="item"  open="(" close=")" separator=",">#{item}</foreach>
		</if>
		  AND TO_CHAR(TO_TIMESTAMP(SRC.CUR_TIME, 'YYYYMMDD HH24MISSFF3'), 'YYYYMMDD HH24MI') > #{START_DT}
		  AND TO_CHAR(TO_TIMESTAMP(SRC.CUR_TIME, 'YYYYMMDD HH24MISSFF3'), 'YYYYMMDD HH24MI') <![CDATA[<]]> #{END_DT}
		ORDER BY TO_CHAR(TO_TIMESTAMP(SRC.CUR_TIME, 'YYYYMMDD HH24MISSFF3'), 'YYYYMMDD HH24MISS') DESC
	</select>
</mapper>